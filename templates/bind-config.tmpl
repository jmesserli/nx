{{- /*gotype: peg.nu/nx/ns/dns.configTemplateVars*/ -}}
/*
 * BIND config generated by nx (https://github.com/jmesserli/nx)
 * Start of config for nameserver {{ .ServerName }}
 */

/* acl and primary lists */
{{ range $aclPrimary := .AclPrimaryLists -}}
{{ $aclPrimary.Type }} "{{$aclPrimary.Name}}" {
{{ range $entry := $aclPrimary.Entries }}   {{ $entry.IP }}{{ if and ($entry.Port) (eq $aclPrimary.Type "masters") }} port {{ $entry.Port }}{{ end }};
{{ end -}}
};
{{ end }}

{{ range $zone := .Zones -}}
zone "{{ $zone.Name }}" {
    type {{ $zone.Type }};
    file "/
	{{- if $zone.IsSecondary -}}
	var/cache/bind
	{{- else -}}
	etc/bind/zones
	{{- end -}}
	/{{ $zone.Name }}.db";
	{{- if $zone.IsSecondary }}
    masters { {{ $zone.PrimaryIP }}{{ if $zone.PrimaryPort }} port {{ $zone.PrimaryPort }}{{ end }}; };
    transfer-source {{ $.ServerIP }};
	{{- else }}
    allow-transfer { {{ range $transferAcl := $zone.TransferAcls }}"{{ $transferAcl }}"; {{ end -}} };
    also-notify { {{ range $primaryAcl := $zone.NotifyPrimaries }}"{{ $primaryAcl }}"; {{ end -}} };
    notify yes;
	{{- end -}}
    {{- if and ($zone.IsDnssecEnabled) (not $zone.IsSecondary) }}
    /* This zone is DNSSEC enabled */
    dnssec-policy default;
    inline-signing yes;
    {{- end }}
};
{{ end }}

/*
 * End of config for nameserver {{ .ServerName }}
 * Generated at {{ .GeneratedAt }}
 */