{{- /*gotype: peg.nu/nx/ns/dns.configTemplateVars*/ -}}
/*
 * BIND config generated by nx (https://github.com/jmesserli/nx)
 * Start of config for nameserver {{ .ServerName }}
 */

/* acl and master lists */
{{ range $aclMaster := .AclMasterLists -}}
{{ $aclMaster.Type }} "{{$aclMaster.Name}}" {
{{ range $ip := $aclMaster.Entries }}   {{ $ip }};
{{ end -}}
};
{{ end }}

{{ range $zone := .Zones -}}
zone "{{ $zone.Name }}" {
    type {{ $zone.Type }};
    file "/
	{{- if $zone.IsSlave -}}
	var/cache/bind
	{{- else -}}
	etc/bind/zones
	{{- end -}}
	/{{ $zone.Name }}.db";
	{{- if $zone.IsSlave }}
    masters { {{ $zone.MasterIP }}; };
    transfer-source {{ $.ServerIP }};
	{{- else }}
    allow-transfer { {{ range $transfer := $zone.TransferAcls }}"{{ $transfer }}"; {{ end -}} };
    also-notify { {{ range $master := $zone.NotifyMasters }}"{{ $master }}"; {{ end -}} };
    notify yes;
	{{- end -}}
    {{- if and ($zone.IsDnssecEnabled) (not $zone.IsSlave) }}
    ; This zone is DNSSEC enabled
    dnssec-policy default;
    inline-signing yes;
    {{- end }}
};
{{ end }}

/*
 * End of config for nameserver {{ .ServerName }}
 * Generated at {{ .GeneratedAt }}
 */