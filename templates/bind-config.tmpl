/*
 * BIND config generated by nx (https://github.com/jmesserli/nx)
 * Start of config for nameserver {{ .ServerName }}
 */

/* ACL allows remote slaves to pull the zones */
acl "nbbx-slaves-transfer" {
{{ range $masterIp := .MasterIPs }}    {{ $masterIp }};
{{ end -}}
};

/* masters enables the notification of remote masters */
masters "nbbx-slaves-notify" {
{{ range $masterIp := .MasterIPs }}    {{ $masterIp }};
{{ end -}}
};

{{ range $zone := .Zones -}}
zone "{{ $zone.Name }}" {
    type {{ $zone.Type }};
    file "/
	{{- if $zone.IsSlave -}}
	var/cache/bind
	{{- else -}}
	etc/bind/zones
	{{- end -}}
	/{{ $zone.Name }}.db";
	{{- if $zone.IsSlave }}
    masters { {{ $zone.MasterIP }}; };
	{{- else }}
    allow-transfer { "nbbx-slaves-transfer"; };
    also-notify { "nbbx-slaves-notify"; };
    notify yes;
	{{- end }}
};
{{ end }}

/*
 * End of config for nameserver {{ .ServerName }}
 * Generated at {{ .GeneratedAt }}
 */